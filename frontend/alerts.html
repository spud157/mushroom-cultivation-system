<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.U.S.H - Alerts & Notifications</title>
    <link rel="stylesheet" href="terminal-status.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header-section">
            <div class="header-content">
                <div class="dashboard-header">
                    <h1 class="main-title">M.U.S.H</h1>
                    <div class="header-controls-centered">
                        <button class="btn btn-primary" onclick="window.location.href='index.html'">
                            Dashboard
                        </button>
                        <button class="btn btn-success" onclick="window.location.href='automation-rules.html'">
                            Automation Rules
                        </button>
                        <button class="btn btn-info active" onclick="window.location.href='alerts.html'">
                            Alerts & Notifications
                        </button>
                        <button class="btn btn-warning" onclick="window.location.href='phase-management.html'">
                            Phase Management
                        </button>
                        <button class="btn btn-secondary" onclick="window.location.href='batch-operations.html'">
                            Batch Operations
                        </button>
                        <button class="btn btn-danger" onclick="window.location.href='sensor-data.html'">
                            Sensor Data
                        </button>
                        <button class="btn btn-dark" onclick="window.location.href='user-management.html'">
                            User Management
                        </button>
                        <button class="btn btn-light" onclick="logout()">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- System Status -->
            <section class="system-status">
                <div class="status-card">
                    <h3>Alerts & Notifications</h3>
                    <div class="status-indicators">
                        <div class="status-item">
                            <span class="status-label">Active Alerts:</span>
                            <span class="status-value" id="active-alerts-count">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Notification Channels:</span>
                            <span class="status-value" id="channels-count">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">System Status:</span>
                            <span class="status-value" id="alerts-system-status">Online</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Alerts Section -->
            <section class="alerts-section">
                <div class="section-header">
                    <h2>Alert Management</h2>
                    <div class="header-controls">
                        <button class="btn btn-primary" onclick="createAlert()">Create Alert</button>
                        <button class="btn btn-success" onclick="testNotifications()">Test Notifications</button>
                        <button class="btn btn-warning" onclick="refreshAlertsData()">Refresh</button>
                    </div>
                </div>
                
                <!-- Tab Navigation -->
                <div class="alerts-tabs">
                    <button class="tab-btn active" onclick="showAlertsTab('active')">Active Alerts</button>
                    <button class="tab-btn" onclick="showAlertsTab('history')">Alert History</button>
                    <button class="tab-btn" onclick="showAlertsTab('channels')">Notification Channels</button>
                </div>

                <!-- Content Area -->
                <div id="alerts-content" class="tab-content">
                    <div class="loading-message">Loading alerts data...</div>
                </div>
            </section>
        </main>
    </div>

    <!-- Trademark Footer -->
    <div class="trademark-footer">
        <span class="trademark-text">Â© Kroll Management LLC</span>
    </div>

    <script src="simple_app.js"></script>
    <script>
        // Page-specific initialization
        window.addEventListener('load', async function() {
            if (!checkAuthentication()) return;
            
            await loadAlertsData();
            showAlertsTab('active');
        });

        // Alerts page functions
        async function loadAlertsData() {
            try {
                const [alertsResponse, historyResponse, channelsResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/alerts`),
                    fetch(`${API_BASE_URL}/alerts/history`),
                    fetch(`${API_BASE_URL}/alerts/channels`)
                ]);
                
                const alerts = await alertsResponse.json();
                const history = await historyResponse.json();
                const channels = await channelsResponse.json();
                
                window.alertsData = { alerts, history, channels };
            } catch (error) {
                console.error('Error loading alerts data:', error);
                document.getElementById('alerts-content').innerHTML = '<div class="error-message">Failed to load alerts data</div>';
            }
        }

        function showAlertsTab(tab) {
            const content = document.getElementById('alerts-content');
            const data = window.alertsData || {};
            
            // Update tab buttons
            document.querySelectorAll('.alerts-tabs .tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            switch(tab) {
                case 'active':
                    content.innerHTML = renderActiveAlerts(data.alerts || []);
                    break;
                case 'history':
                    content.innerHTML = renderAlertHistory(data.history || []);
                    break;
                case 'channels':
                    content.innerHTML = renderAlertChannels(data.channels || []);
                    break;
            }
        }

        function renderActiveAlerts(alerts) {
            if (!alerts.length) return '<div class="empty-state">No active alerts</div>';
            
            return `<div class="alerts-grid">
                ${alerts.map(alert => `
                    <div class="alert-item ${alert.severity}">
                        <h4>${alert.message}</h4>
                        <p>Chamber: ${alert.chamber_id} | Severity: ${alert.severity}</p>
                        <p>Created: ${alert.created_at}</p>
                        <div class="alert-actions">
                            <button class="btn btn-sm btn-primary" onclick="acknowledgeAlert('${alert.id}')">Acknowledge</button>
                            <button class="btn btn-sm btn-secondary" onclick="viewAlertDetails('${alert.id}')">Details</button>
                        </div>
                    </div>
                `).join('')}
            </div>`;
        }

        function renderAlertHistory(history) {
            if (!history.length) return '<div class="empty-state">No alert history</div>';
            
            return `<div class="history-grid">
                ${history.map(alert => `
                    <div class="alert-history-item">
                        <h5>${alert.message}</h5>
                        <p>Chamber: ${alert.chamber_id} | Status: ${alert.status}</p>
                        <p>Created: ${alert.created_at} | Resolved: ${alert.resolved_at || 'N/A'}</p>
                    </div>
                `).join('')}
            </div>`;
        }

        function renderAlertChannels(channels) {
            return `<div class="channels-grid">
                ${channels.map(channel => `
                    <div class="alert-channel-item">
                        <h5>${channel.name} (${channel.type})</h5>
                        <p>Endpoint: ${channel.endpoint}</p>
                        <p>Status: ${channel.enabled ? 'Enabled' : 'Disabled'}</p>
                        <div class="channel-actions">
                            <button class="btn btn-sm btn-warning" onclick="toggleChannel('${channel.id}')">Toggle</button>
                            <button class="btn btn-sm btn-primary" onclick="testChannel('${channel.id}')">Test</button>
                            <button class="btn btn-sm btn-secondary" onclick="editChannel('${channel.id}')">Edit</button>
                        </div>
                    </div>
                `).join('')}
            </div>`;
        }

        // Action functions
        function createAlert() {
            alert('Create Alert functionality - Coming Soon!');
        }

        function testNotifications() {
            alert('Test Notifications functionality - Coming Soon!');
        }

        function refreshAlertsData() {
            loadAlertsData().then(() => {
                showAlertsTab('active');
                alert('Alerts data refreshed successfully!');
            });
        }

        function acknowledgeAlert(alertId) {
            alert(`Alert ${alertId} acknowledged!`);
        }

        function viewAlertDetails(alertId) {
            alert(`Viewing details for alert ${alertId}`);
        }

        function toggleChannel(channelId) {
            alert(`Toggling channel ${channelId}`);
        }

        function testChannel(channelId) {
            alert(`Testing channel ${channelId}`);
        }

        function editChannel(channelId) {
            alert(`Editing channel ${channelId}`);
        }

        // Make functions globally accessible
        window.showAlertsTab = showAlertsTab;
        window.createAlert = createAlert;
        window.testNotifications = testNotifications;
        window.refreshAlertsData = refreshAlertsData;
    </script>
</body>
</html>
